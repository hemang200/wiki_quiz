<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wiki Quiz Generator</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    min-height: 100vh;
    padding: 20px;
}
.container {
    max-width: 1000px;
    margin: auto;
    background: white;
    border-radius: 10px;
    overflow: hidden;
}
.header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px;
    text-align: center;
}
.tabs {
    display: flex;
}
.tab-button {
    flex: 1;
    padding: 15px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}
.tab-button.active {
    background: white;
    color: #667eea;
}
.tab-content {
    display: none;
    padding: 20px;
}
.tab-content.active {
    display: block;
}
.error {
    background: #fee;
    padding: 10px;
    margin-bottom: 10px;
}
.success {
    background: #efe;
    padding: 10px;
    margin-bottom: 10px;
}
.quiz-card {
    border: 1px solid #ddd;
    margin-bottom: 15px;
    padding: 10px;
}
.options div {
    padding: 5px;
}
.modal {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.5);
}
.modal.show {
    display:flex;
    align-items:center;
    justify-content:center;
}
.modal-content {
    background:white;
    padding:20px;
    max-width:800px;
    width:100%;
}
</style>
</head>
<body>

<div class="container">
<div class="header">
<h1>ðŸ“š Wiki Quiz Generator</h1>
<p>Generate quizzes from Wikipedia using AI</p>
</div>

<div class="tabs">
<button class="tab-button active" onclick="switchTab('generate', this)">Generate Quiz</button>
<button class="tab-button" onclick="switchTab('history', this)">History</button>
</div>

<div id="generate" class="tab-content active">
<div id="generateError" class="error" style="display:none;"></div>

<input type="text" id="wikiUrl" placeholder="https://en.wikipedia.org/wiki/Alan_Turing" style="width:100%;padding:10px;">
<br><br>
<button onclick="generateQuiz()">Generate Quiz</button>
<div id="generateResult"></div>
</div>

<div id="history" class="tab-content">
<div id="historyError" class="error" style="display:none;"></div>
<button onclick="loadHistory()">Load History</button>
<div id="historyResult"></div>
</div>
</div>

<div id="detailsModal" class="modal">
<div class="modal-content">
<button onclick="closeModal()">Close</button>
<h2 id="modalTitle"></h2>
<div id="modalBody"></div>
</div>
</div>

<script>
const API_URL = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1"
    ? "http://localhost:8000"
    : "https://wiki-quiz-api-i2ay.onrender.com";

function switchTab(tab, btn){
document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
document.querySelectorAll(".tab-button").forEach(b=>b.classList.remove("active"));
document.getElementById(tab).classList.add("active");
btn.classList.add("active");
}

async function generateQuiz(){
const url = document.getElementById("wikiUrl").value.trim();
const errorDiv = document.getElementById("generateError");
const resultDiv = document.getElementById("generateResult");
errorDiv.style.display="none";
resultDiv.innerHTML="";

if(!url || !url.includes("wikipedia.org/wiki/")){
errorDiv.textContent="Enter valid Wikipedia URL";
errorDiv.style.display="block";
return;
}

try{
const res = await fetch(`${API_URL}/api/generate-quiz`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({url})
});

if(!res.ok) throw new Error("API Error");
const data = await res.json();

let html = `<div class="success">Quiz Generated</div>
<h2>${data.title}</h2>
<p>${data.summary}</p>`;

data.quiz.forEach((q,i)=>{
html+=`
<div class="quiz-card">
<h3>Q${i+1}. ${q.question}</h3>
<div class="options">${q.options.map(o=>`<div>${o}</div>`).join("")}</div>
<p><b>Answer:</b> ${q.answer}</p>
<p>${q.explanation}</p>
</div>`;
});

resultDiv.innerHTML=html;

}catch(err){
errorDiv.textContent="Failed to fetch from API";
errorDiv.style.display="block";
}
}

async function loadHistory(){
const res = await fetch(`${API_URL}/api/history`);
const data = await res.json();

let html="<table border='1'><tr><th>Title</th><th>Action</th></tr>";
data.forEach(q=>{
html+=`<tr><td>${q.title}</td><td><button onclick="viewDetails(${q.id})">View</button></td></tr>`;
});
html+="</table>";

document.getElementById("historyResult").innerHTML=html;
}

async function viewDetails(id){
const res = await fetch(`${API_URL}/api/quiz/${id}`);
const data = await res.json();

document.getElementById("modalTitle").textContent=data.title;
document.getElementById("modalBody").innerHTML=JSON.stringify(data,null,2);
document.getElementById("detailsModal").classList.add("show");
}

function closeModal(){
document.getElementById("detailsModal").classList.remove("show");
}
</script>
</body>
</html>